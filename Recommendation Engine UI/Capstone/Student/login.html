<!DOCTYPE html>
<html lang="en-US">
<head>
<title>Virtual Academic Advisor Login Page</title>
<meta charset="UTF-8" >
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css'>

<link rel='stylesheet' href='https://fonts.googleapis.com/icon?family=Material+Icons'>

<link rel="stylesheet" href="styles.css" >

<script src="jquery-3.2.1.js"></script>
<style>
* {
  box-sizing: border-box;
}

html {
  height: 100%;
}

body {
  margin: 0;
  padding: 0;
  font-size: 100%;
  font-family: 'Open Sans', sans-serif;
  height: 100%;
}

.loginbox {
  border: 1px solid rgb(150, 150, 150);
  position: relative;
  width: 25%;
  top: 40%;
  left: 35%;
  padding: 1em 1em;
}
</style>
</head>
<body>

<div class='loginbox'>
  <label style='display: block;'>Student ID:</label>
  <input id='studentID' type='text' placeholder='enter student id'>
  <label style='display: block;'>PIN:</label>
  <input id='pin' type='text' placeholder='enter pin'><br>
    <button id='loginbutton'>Log In</button>
</div>

<script>
//set initial value for all status on whether to call an ajax
//UPDATE!!
localStorage.setItem('activePlanRetrieved', '0');
var retrieveActivePlanInfoReady = false;
var retrieveInactivePlanInfoReady = false;
$(document).ready(function() {
    $('#loginbutton').click(function() {
	    apiURL = 'http://localhost:5000/api/Vsa/getActivePlanInfo/';
		apiURL += $('#studentID').val();
		$.ajax({
		    url: apiURL,
		    type: 'GET',
		    dataType: 'json',
		    success: function(jsonText) {
			    console.log('This is the active plan info: ' + jsonText);
				//this section will check if student has an active plan or not
			    if (jsonText.parameterSet.planID == -1) {
				    localStorage.setItem('jsonActivePlanID', jsonText.planId);
				} else {
				    localStorage.setItem('jsonMajor', jsonText.parameterSet.major);
				    localStorage.setItem('jsonCollege', jsonText.parameterSet.school);
				    localStorage.setItem('jsonActivePlanID', jsonText.planId);
					//localStorage.setItem('jsonDegree', jsonText.);
				    localStorage.setItem('jsonTimePref', jsonText.parameterSet.timePreference);
					//localStorage.setItem('jsonTypeOfEnroll', jsonText[5]);
					//localStorage.setItem('jsonSummerOption', jsonText[6]);
				    localStorage.setItem('jsonQuarter', jsonText.parameterSet.quarterPreference);
				    localStorage.setItem('jsonJobType', jsonText.parameterSet.jobType);
				    localStorage.setItem('jsonActivePlanCreatedDate', jsonText.parameterSet.dataAdded);
				    localStorage.setItem('jsonActivePlanModifiedDate', jsonText.parameterSet.lastDateModified);
				}
				retrieveActivePlanInfoReady = true;
		    },
		    error: function() {
		        console.log('AJAX failed');
		    }
		})
		apiURL = 'http://localhost:5000/api/Vsa/getInactivePlanInfo/';
		apiURL += $('#studentID').val();
	    $.ajax({
	        url: apiURL,
	        type: 'GET',
	        dataType: 'json',
	        success: function(jsonText) {
		        console.log('These are the inactive plan names: ' + jsonText + '.');
				//this section will check if student has any inactive plan or not
				if (jsonText.length == 0) {
				    console.log('array is empty');
				    localStorage.setItem('inactivePlanArray', JSON.stringify(jsonText));
				} else {
				    localStorage.setItem('inactivePlanArray', JSON.stringify(jsonText));
				}
			    retrieveInactivePlanInfoReady = true;
	        },
			error: function() {
			    console.log('AJAX failed');
			}
		})
		
		apiURL = 'http://localhost:5000/api/Vsa/getCourses';
	    $.ajax({
	        url: apiURL,
	        type: 'GET',
	        dataType: 'json',
	        success: function(jsonText) {
		        console.log('These are the courses offered at EVCC: ' + jsonText);
			    localStorage.setItem('courseArray', JSON.stringify(jsonText));
				//while(!(retrieveActivePlanInfoReady && retrieveInactivePlanInfoReady)) {};
				var count = 0;
				while(!(retrieveActivePlanInfoReady)) {
				    count++;
					console.log(count);
				};
			    location.href = 'Student%20Dashboard/student-dashboard.html';
	        },
			error: function() {
			    console.log('AJAX failed');
			}
		})
	});
});
</script>
</body>
</html>