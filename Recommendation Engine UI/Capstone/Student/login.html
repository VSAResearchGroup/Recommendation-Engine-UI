<!DOCTYPE html>
<html lang="en-US">
<head>
<title>Virtual Academic Advisor Login Page</title>
<meta charset="UTF-8" >
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css'>

<link rel='stylesheet' href='https://fonts.googleapis.com/icon?family=Material+Icons'>

<link rel="stylesheet" href="styles.css" >

<script src="jquery-3.2.1.js"></script>
<style>
* {
  box-sizing: border-box;
}

html {
  height: 100%;
}

body {
  margin: 0;
  padding: 0;
  font-size: 100%;
  font-family: 'Open Sans', sans-serif;
  height: 100%;
}

.loginbox {
  border: 1px solid rgb(150, 150, 150);
  position: relative;
  width: 25%;
  top: 40%;
  left: 35%;
  padding: 1em 1em;
}
</style>
</head>
<body>

<div class='loginbox'>
  <label style='display: block;'>Student ID:</label>
  <input id='studentID' type='text' placeholder='enter student id'>
  <label style='display: block;'>PIN:</label>
  <input id='pin' type='text' placeholder='enter pin'><br>
    <button id='loginbutton'>Log In</button>
</div>

<script>
var productionURL = 'http://localhost:5000/';
$(document).ready(function() {
    $('#loginbutton').click(function() {
	   
		//Uncomment these codes if testing locally and connected to the backend (i.e. making AJAX calls)
		//Comment these codes if testing locally without connected to the backend (i.e. not making AJAX calls)
		
		//keep status on what info already retrieved from DB
		var ajaxStatusObject = { retrieveActivePlanInfoReady: '0'}; 
		sessionStorage.setItem('recentSAjaxStatusProperties', JSON.stringify(ajaxStatusObject));
		sessionStorage.setItem('sessionSAjaxStatusProperties', JSON.stringify(ajaxStatusObject));
		
		sessionStorage.setItem('nextWebPage', 'Student%20Dashboard/student-dashboard.html');
		//change the last section(getActivePlanInfo/) as according to actual function call name
	    apiURL = productionURL + 'api/Vsa/getActivePlanInfo/';
		apiURL += $('#studentID').val();
		$.ajax({
		    url: apiURL,
		    type: 'GET',
		    dataType: 'json',
		    success: function(jsonText) {
				//only checking if array of objects (JSON) was passed successfully
			    console.log('This is the active plan info: ' + jsonText);
				//this section will check if student has an active plan or not
			    if (jsonText.parameterSet.planID == -1) {
				    sessionStorage.setItem('jsonActivePlanID', jsonText.planId);
				} else {
				    sessionStorage.setItem('studentActivePlanInfo', JSON.stringify(jsonText));
					ajaxStatusObject['retrieveActivePlanInfoReady'] = '1';  //1 means successfully retrieved
					//saving it locally
				    sessionStorage.setItem('recentSAjaxStatusProperties', JSON.stringify(ajaxStatusObject));
				}
		    },
		    error: function() {
		        console.log('AJAX failed');
		    }
		})
		
		//keep status on what info already retrieved from DB
		ajaxStatusObject.retrieveInactivePlanInfoReady = '0'; 
		sessionStorage.setItem('recentSAjaxStatusProperties', JSON.stringify(ajaxStatusObject));
		sessionStorage.setItem('sessionSAjaxStatusProperties', JSON.stringify(ajaxStatusObject));
		//change the last section(getInactivePlanInfo/) as according to actual function call name
		apiURL = productionURL + 'api/Vsa/getInactivePlanInfo/';
		apiURL += $('#studentID').val();
	    $.ajax({
	        url: apiURL,
	        type: 'GET',
	        dataType: 'json',
	        success: function(jsonText) {
			    //only checking if array of objects (JSON) was passed successfully
		        console.log('These are the inactive plan names: ' + jsonText + '.');
				//this section will check if student has any inactive plan or not
				if (jsonText.length == 0) {
				    console.log('array is empty');
				    sessionStorage.setItem('inactivePlanInfoArray', JSON.stringify(jsonText));
				} else {
				    sessionStorage.setItem('inactivePlanInfoArray', JSON.stringify(jsonText));
					ajaxStatusObject['retrieveInactivePlanInfoReady'] = '1';  //1 means successfully retrieved
					//saving it locally
				    sessionStorage.setItem('recentSAjaxStatusProperties', JSON.stringify(ajaxStatusObject));
				}
	        },
			error: function() {
			    console.log('AJAX failed');
			}
		})
		
		//keep status on what info already retrieved from DB
        ajaxStatusObject.retrieveCourseListReady = '0'; 
		sessionStorage.setItem('recentSAjaxStatusProperties', JSON.stringify(ajaxStatusObject));
		sessionStorage.setItem('sessionSAjaxStatusProperties', JSON.stringify(ajaxStatusObject));
		//change the last section(getCourses/) as according to actual function call name
		apiURL = productionURL + 'api/Vsa/getCourses';
	    $.ajax({
	        url: apiURL,
	        type: 'GET',
	        dataType: 'json',
	        success: function(jsonText) {
			    //only checking if array of objects (JSON) was passed successfully
		        console.log('These are the courses offered at EVCC: ' + jsonText);
			    sessionStorage.setItem('courseListArray', JSON.stringify(jsonText));
				ajaxStatusObject['retrieveCourseListReady'] = '1';  //1 means successfully retrieved
				//saving it locally
				sessionStorage.setItem('recentSAjaxStatusProperties', JSON.stringify(ajaxStatusObject));
	        },
			error: function() {
			    console.log('AJAX failed');
			}
		})
		location.href = 'loading.html';  // redirect to loading page
	});
});
</script>
</body>
</html>